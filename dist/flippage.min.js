function initPageFlip(){for(var e=$(window).height(),t=0,a=$(".page-block").length,n=$(".page-block>.upper-block"),p=$(".page-block>.lower-block"),d=200,i=0;i<n.length;i++)0!==i&&updatePos(-180,n[i]),updateZIndex(a-i,n[i]),updateZIndex(a-i,p[i]),0!==i&&1!==i&&(updateDisplay(!1,n[i]),updateDisplay(!1,p[i]));var u=$(".page-wrapper").get(0);if(u){var s=new Hammer(u);s.add(new Hammer.Pan({threshold:0,pointers:0}));var o={x:0,y:0};s.on("panstart panmove",function(i){if("panstart"==i.type&&(_x=o.x||0,_y=o.y||0),o.x=_x+i.deltaX,o.y=_y+i.deltaY,o.y<=0){o.y<=-d&&a-t<=1&&(o.y=-d);var u=o.y/(e/2)*-90;updatePos(u,p[t]),updateZIndex(a+1,p[t]);var s=(2+o.y/(e/2))*-90;updatePos(s,n[t+1]),updateZIndex(a,n[t+1])}else{o.y>=d&&0===t&&(o.y=d);var u=o.y/(e/2)*-90;updatePos(u,n[t]),updateZIndex(a,n[t]);var s=90*(2-o.y/(e/2));updatePos(s,p[t-1]),updateZIndex(a+1,p[t-1])}}),s.on("panend",function(e){o.y<-100&&a-t>1?(t++,updateAni(0,p[t]),updateAni(0,n[t]),updateAni(-180,n[t+1]),updateAni(180,p[t-1]),o.x=0,o.y=0,setTimeout(function(){updateZIndex(a,n[t-1]),updateZIndex(a,p[t-1]),updateZIndex(a,n[t]),updateZIndex(a,p[t]),updateDisplay(!0,n[t+1]),updateDisplay(!0,p[t+1]),updateDisplay(!1,n[t-2]),updateDisplay(!1,p[t-2])},0)):o.y>100&&t>0?(t--,updateAni(0,p[t]),updateAni(0,n[t]),updateAni(-180,n[t+1]),updateAni(180,p[t-1]),o.x=0,o.y=0,setTimeout(function(){updateZIndex(a-t-1,n[t+1]),updateZIndex(a-t-1,p[t+1]),updateZIndex(a,n[t]),updateZIndex(a,p[t]),updateDisplay(!0,n[t-1]),updateDisplay(!0,p[t-1]),updateDisplay(!1,n[t+2]),updateDisplay(!1,p[t+2])},0)):(updateAni(0,p[t]),updateAni(0,n[t]),updateAni(-180,n[t+1]),updateAni(180,p[t-1]),updateZIndex(a,n[t]),updateZIndex(a,p[t]),updateZIndex(a-t-1,n[t+1]),updateZIndex(a,p[t-1]),o.x=0,o.y=0)})}}function updatePos(e,t){if(t){var a=["perspective(1000px) rotate3d(1, 0, 0, "+e+"deg)"];t.style.webkitTransition="none",t.style.mozTransition="none",t.style.transition="none",t.style.webkitTransform=a,t.style.mozTransform=a,t.style.transform=a}}function updateAni(e,t){if(t){var a=["perspective(1000px) rotate3d(1, 0, 0, "+e+"deg)"];t.style.webkitTransition="all 0.5s",t.style.mozTransition="all 0.5s",t.style.transition="all 0.5s",t.style.webkitTransform=a,t.style.mozTransform=a,t.style.transform=a}}function updateZIndex(e,t){t&&(t.style.zIndex=e)}function updateDisplay(e,t){t&&(e?t.style.display="block":t.style.display="none")}